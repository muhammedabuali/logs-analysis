% model with float vars
include "globals.mzn";

int : n_vehicles = 20;
int : n_jobs = 55;
set of int: JOBS = 1..n_jobs;
set of int: VEHICLES = 1..n_vehicles;
array[JOBS,1..2] of int: job_start =
[|242320,	993371,
|541820,	993371,
|642264,	993371,
|642264,	993371,
|342320,	993371,
|342320,	993371,
|342320,	993371,
|342320,	993371,
|741854,	993371,
|541820,	993371,
|541820,	993371,
|642264,	993371,
|642264,	993371,
|741854,	993371,
|541820,	993371,
|541820,	993371,
|541820,	993371,
|342320,	993371,
|342320,	993371,
|342320,	993371,
|741854,	993371,
|242320,	993371,
|342320,	993371,
|541820,	993371,
|642264,	993371,
|642264,	993371,
|642264,	993371,
|741854,	993371,
|79241,	681440,
|342320,	993371,
|441803,	993371,
|541820,	993371,
|79241,	666440,
|342320,	993371,
|541820,	993371,
|541820,	993371,
|642264,	993371,
|741854,	993371,
|79241,	906440,
|541820,	993371,
|541820,	993371,
|642264,	993371,
|642264,	993371,
|741854,	993371,
|342320,	993371,
 |342320,	993371,
 |541820,	993371,
 |642264,	993371,
 |642264,	993371,
 |741854,	993371,
 |541820,	993371,
 |541820,	993371,
 |642264,	993371,
 |741854,	993371,
 |741854,	993371|];

array[JOBS,1..2] of int: job_end =
[|479241,	719607,
|479241,	469607,
|479241,	319607,
|312302,	950696,
|712302,	950696,
|482302,	950696,
|479241,	719607,
|479241,	719607,
|479241,	269607,
|479241,	319607,
|479241,	419607,
|479241,	869607,
|479241,	469607,
|479241,	319607,
|479241,	269607,
|479241,	569607,
|479241,	719607,
|479241,	469607,
|672302,	950696,
|482302,	950696,
|479241,	369607,
|479241,	219607,
|479241,	319607,
|479241,	719607,
|479241,	469607,
|662302,	950696,
|479241,	719607,
|479241,	369607,
|479241,	719607,
|479241,	469607,
|479241,	469607,
|372302,	950696,
|479241,	819607,
|479241,	869607,
|479241,	569607,
|479241,	569607,
|479241,	569607,
|479241,	769607,
|479241,	819607,
|479241,	469607,
|479241,	219607,
|479241,	369607,
|479241,	569607,
|479241,	319607,
|322302,	950696,
|482302,	950696,
|479241,	819607,
|479241,	369607,
|479241,	319607,
|479241,	319607,
|479241,	819607,
|582302,	950696,
|479241,	819607,
|479241,	419607,
|479241,	319607|];
array[VEHICLES,1..2] of int: start_pos=
[|212302,	950696,
 |222302,	950696,
 |232302,	950696,
 |242302,	950696,
 |252302,	950696,
 |262302,	950696,
 |272302,	950696,
 |282302,	950696,
 |292302,	950696,
 |302302,	950696,
 |312302,	950696,
 |322302,	950696,
 |332302,	950696,
 |342302,	950696,
 |352302,	950696,
 |362302,	950696,
 |372302,	950696,
 |382302,	950696,
 |392302,	950696,
 |402302,	950696|];

function var float: distance(var float: x1,var float: y1,var float: x2,var float: y2)=
abs(x1-x2)+abs(y1-y2);

% assign vehicles to jobs
array[VEHICLES,JOBS] of var 0..1: assign;

array[VEHICLES] of var JOBS :: output_only: job_assign;

constraint forall(v in VEHICLES)
(sum(j in JOBS)(assign[v,j]*j) = job_assign[v]);

% domain
constraint forall(v in VEHICLES, j in JOBS)
(( assign[v,j] >= 0 ) /\( assign[v,j] <= 1 ));

% assign exactly one job to the vehicle
constraint forall(v in VEHICLES)
(sum(j in JOBS)(assign[v,j]) = 1);


% assign at most one vehicle to the job
constraint forall(j in JOBS)
(sum(v in VEHICLES)(assign[v,j]) <= 1);

% actual assignments
% constraint assign = [18,23,20,01,19,10,13,11,14,08,17,06,07,05,12,03,16,09,02,04];
% 4450204

% best found assignments
% constraint assign = [7, 39, 8, 20, 6, 22, 19, 5, 1, 3, 2, 23, 18, 30, 10, 34, 45, 46, 11, 31];
% _objective = 2696231;

% minimize total travelled distance
solve minimize sum(v in VEHICLES, j in JOBS)(distance(start_pos[v,1], start_pos[v,2], job_start[j,1], job_start[j,2]) * assign[v,j] );

% minimize max distance per vehicle(makespan)
% solve minimize max([distance(start_pos[v,1], start_pos[v,2], job_start[assign[v],1], job_start[assign[v],2])
                                  % + distance(job_start[assign[v],1], job_start[assign[v],2], job_end[assign[v],1], job_end[assign[v],2])
                    % | v in VEHICLES]);
